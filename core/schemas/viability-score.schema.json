{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "viability-score.schema.json",
  "title": "APEX Viability Score",
  "description": "Schema for viability assessment output produced by the APEX Viability Scoring Protocol (TSK-012)",
  "type": "object",
  "required": ["viability_assessment"],
  "properties": {
    "viability_assessment": {
      "type": "object",
      "required": [
        "candidate",
        "dimensions",
        "scoring",
        "classification",
        "assessment_metadata"
      ],
      "properties": {
        "candidate": {
          "$ref": "#/definitions/candidate"
        },
        "dimensions": {
          "$ref": "#/definitions/dimensions"
        },
        "scoring": {
          "$ref": "#/definitions/scoring"
        },
        "classification": {
          "$ref": "#/definitions/classification"
        },
        "limitations": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Documented limitations for VIABLE candidates"
        },
        "recommendations": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Actionable recommendations based on assessment"
        },
        "assessment_metadata": {
          "$ref": "#/definitions/assessment_metadata"
        }
      }
    }
  },
  "definitions": {
    "candidate": {
      "type": "object",
      "required": ["name", "domain"],
      "properties": {
        "name": {
          "type": "string",
          "description": "Full name of the person or entity being assessed"
        },
        "domain": {
          "type": "string",
          "description": "Primary domain of expertise (e.g., 'B2B Sales', 'Marketing', 'Finance')"
        },
        "aliases": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Alternative names or known aliases"
        },
        "source_summary": {
          "type": "object",
          "properties": {
            "total_hours_estimated": {
              "type": "number",
              "minimum": 0,
              "description": "Estimated total hours of available content"
            },
            "source_types": {
              "type": "array",
              "items": {
                "type": "string",
                "enum": [
                  "book",
                  "course",
                  "podcast_own",
                  "podcast_guest",
                  "youtube_channel",
                  "youtube_guest",
                  "conference_keynote",
                  "mastermind",
                  "workshop",
                  "social_media",
                  "blog_article",
                  "academic_paper",
                  "interview",
                  "other"
                ]
              },
              "description": "Types of content sources identified"
            },
            "date_range": {
              "type": "object",
              "properties": {
                "earliest": {
                  "type": "string",
                  "description": "Earliest content date (YYYY or YYYY-MM)"
                },
                "latest": {
                  "type": "string",
                  "description": "Latest content date (YYYY or YYYY-MM)"
                }
              }
            },
            "primary_language": {
              "type": "string",
              "description": "Primary language of the content"
            }
          }
        }
      }
    },
    "dimensions": {
      "type": "object",
      "required": [
        "accessibility",
        "pattern_richness",
        "expertise_depth",
        "x_factor",
        "icp_match",
        "consistency"
      ],
      "properties": {
        "accessibility": {
          "$ref": "#/definitions/dimension_score"
        },
        "pattern_richness": {
          "$ref": "#/definitions/dimension_score"
        },
        "expertise_depth": {
          "$ref": "#/definitions/dimension_score"
        },
        "x_factor": {
          "$ref": "#/definitions/dimension_score"
        },
        "icp_match": {
          "$ref": "#/definitions/dimension_score"
        },
        "consistency": {
          "$ref": "#/definitions/dimension_score"
        }
      }
    },
    "dimension_score": {
      "type": "object",
      "required": ["score", "evidence"],
      "properties": {
        "score": {
          "type": "integer",
          "minimum": 0,
          "maximum": 20,
          "description": "Score for this dimension (0-20)"
        },
        "evidence": {
          "type": "string",
          "minLength": 20,
          "description": "Evidence justifying the score. Must reference specific content or observations."
        },
        "red_flags": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Any red flags detected for this dimension"
        },
        "notes": {
          "type": "string",
          "description": "Additional notes or qualifications"
        }
      }
    },
    "scoring": {
      "type": "object",
      "required": [
        "raw_score",
        "raw_maximum",
        "normalized_score",
        "icp_adjusted"
      ],
      "properties": {
        "raw_score": {
          "type": "integer",
          "minimum": 0,
          "maximum": 120,
          "description": "Sum of all 6 dimension scores"
        },
        "raw_maximum": {
          "type": "integer",
          "enum": [120],
          "description": "Maximum possible raw score"
        },
        "normalized_score": {
          "type": "number",
          "minimum": 0,
          "maximum": 100,
          "description": "Normalized to 0-100 scale: (raw_score / 120) * 100"
        },
        "icp_adjusted": {
          "type": "boolean",
          "description": "Whether the ICP-adjusted formula was used (when no specific user context)"
        },
        "dimension_floor_violations": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["dimension", "score", "floor"],
            "properties": {
              "dimension": {
                "type": "string",
                "enum": ["accessibility", "pattern_richness", "consistency"]
              },
              "score": {
                "type": "integer"
              },
              "floor": {
                "type": "integer"
              }
            }
          },
          "description": "Dimensions that violated minimum floor thresholds"
        }
      }
    },
    "classification": {
      "type": "object",
      "required": ["label", "action"],
      "properties": {
        "label": {
          "type": "string",
          "enum": ["AUTO-REJECT", "VIABLE", "STRONG", "EXCEPTIONAL"],
          "description": "Classification based on normalized score and floor checks"
        },
        "action": {
          "type": "string",
          "enum": [
            "reject_and_archive",
            "proceed_with_limitations",
            "proceed_standard",
            "proceed_priority"
          ],
          "description": "Required action based on classification"
        },
        "rejection_reason": {
          "type": "string",
          "description": "Required when label is AUTO-REJECT. Explains why candidate was rejected."
        },
        "pipeline_priority": {
          "type": "string",
          "enum": ["none", "normal", "high"],
          "description": "Pipeline processing priority"
        },
        "estimated_token_savings": {
          "type": "string",
          "description": "Estimated token savings from early rejection (for AUTO-REJECT only)"
        }
      }
    },
    "assessment_metadata": {
      "type": "object",
      "required": ["assessed_at", "assessed_by", "protocol_version"],
      "properties": {
        "assessed_at": {
          "type": "string",
          "format": "date-time",
          "description": "ISO 8601 timestamp of assessment"
        },
        "assessed_by": {
          "type": "string",
          "description": "Who performed the assessment (e.g., '@jarvis', '@human')"
        },
        "protocol_version": {
          "type": "string",
          "description": "Version of APEX protocol used",
          "pattern": "^\\d+\\.\\d+\\.\\d+$"
        },
        "research_time_minutes": {
          "type": "integer",
          "minimum": 0,
          "description": "Time spent on preliminary research in minutes"
        },
        "samples_reviewed": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of content samples reviewed during assessment"
        },
        "confidence": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Assessor confidence in the overall score (0.0-1.0)"
        }
      }
    }
  }
}
