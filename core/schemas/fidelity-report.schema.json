{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "fidelity-report.schema.json",
  "title": "Fidelity Report",
  "description": "Schema for clone fidelity assessment reports generated by the Blind Testing Protocol",
  "type": "object",
  "required": [
    "version",
    "report_id",
    "created_at",
    "clone_id",
    "clone_name",
    "evaluator_count",
    "test_summary",
    "category_results",
    "dimension_scores",
    "composite_score",
    "classification",
    "overall_result"
  ],
  "properties": {
    "version": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+\\.\\d+$",
      "description": "Schema version"
    },
    "report_id": {
      "type": "string",
      "pattern": "^FR-\\d{4}-\\d{2}-\\d{2}-[A-Z]{2,5}-\\d{3}$",
      "description": "Unique report identifier. Format: FR-YYYY-MM-DD-PREFIX-NNN",
      "examples": ["FR-2026-02-28-AH-001", "FR-2026-03-15-CG-002"]
    },
    "created_at": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp of report generation"
    },
    "clone_id": {
      "type": "string",
      "description": "Identifier of the clone being tested (matches agent directory name)",
      "examples": ["ALEX-HORMOZI", "COLE-GORDON"]
    },
    "clone_name": {
      "type": "string",
      "description": "Human-readable name of the person the clone represents"
    },
    "clone_version": {
      "type": "string",
      "description": "Version of the clone's AGENT.md at time of testing"
    },
    "previous_report_id": {
      "type": ["string", "null"],
      "description": "Reference to previous fidelity report for regression tracking"
    },
    "evaluator_count": {
      "type": "integer",
      "minimum": 3,
      "description": "Number of independent evaluators"
    },
    "inter_rater_reliability": {
      "type": "number",
      "minimum": 0,
      "maximum": 1,
      "description": "Cohen's kappa coefficient for inter-rater agreement"
    },
    "test_summary": {
      "type": "object",
      "required": ["total_tests", "by_category"],
      "properties": {
        "total_tests": {
          "type": "integer",
          "minimum": 85,
          "description": "Total number of test cases administered"
        },
        "by_category": {
          "type": "object",
          "required": ["direct_quote", "decision_scenario", "style", "edge_case"],
          "properties": {
            "direct_quote": {
              "type": "integer",
              "minimum": 1,
              "description": "Number of direct quote tests (target: 30% of total)"
            },
            "decision_scenario": {
              "type": "integer",
              "minimum": 1,
              "description": "Number of decision scenario tests (target: 25% of total)"
            },
            "style": {
              "type": "integer",
              "minimum": 1,
              "description": "Number of style tests (target: 25% of total)"
            },
            "edge_case": {
              "type": "integer",
              "minimum": 1,
              "description": "Number of edge case tests (target: 20% of total)"
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "category_results": {
      "type": "object",
      "required": ["direct_quote", "decision_scenario", "style", "edge_case"],
      "properties": {
        "direct_quote": {
          "$ref": "#/definitions/direct_quote_result"
        },
        "decision_scenario": {
          "$ref": "#/definitions/decision_scenario_result"
        },
        "style": {
          "$ref": "#/definitions/style_result"
        },
        "edge_case": {
          "$ref": "#/definitions/edge_case_result"
        }
      },
      "additionalProperties": false
    },
    "dimension_scores": {
      "type": "object",
      "required": ["content", "linguistic", "reasoning", "emotional", "paradox"],
      "properties": {
        "content": {
          "$ref": "#/definitions/dimension_score"
        },
        "linguistic": {
          "$ref": "#/definitions/dimension_score"
        },
        "reasoning": {
          "$ref": "#/definitions/dimension_score"
        },
        "emotional": {
          "$ref": "#/definitions/dimension_score"
        },
        "paradox": {
          "$ref": "#/definitions/dimension_score"
        }
      },
      "additionalProperties": false
    },
    "composite_score": {
      "type": "number",
      "minimum": 0,
      "maximum": 100,
      "description": "Weighted composite fidelity score. Formula: (Content*0.30 + Linguistic*0.25 + Reasoning*0.25 + Emotional*0.10 + Paradox*0.10)"
    },
    "classification": {
      "type": "string",
      "enum": ["EXCEPTIONAL", "TARGET_MET", "ACCEPTABLE", "NEEDS_IMPROVEMENT", "FAILING"],
      "description": "Fidelity classification based on composite score"
    },
    "overall_result": {
      "type": "string",
      "enum": ["PASS", "CONDITIONAL_PASS", "FAIL"],
      "description": "Overall pass/fail determination"
    },
    "distinguishability_rate": {
      "type": "number",
      "minimum": 0,
      "maximum": 100,
      "description": "Percentage of tests where evaluator correctly identified the clone"
    },
    "regression": {
      "type": "object",
      "description": "Regression data compared to previous test (null if first test)",
      "properties": {
        "previous_composite": {
          "type": ["number", "null"],
          "minimum": 0,
          "maximum": 100
        },
        "delta": {
          "type": ["number", "null"],
          "description": "Change in composite score from previous test (positive = improvement)"
        },
        "regression_detected": {
          "type": "boolean",
          "description": "True if delta < -5%"
        },
        "regression_severity": {
          "type": ["string", "null"],
          "enum": ["NONE", "MINOR", "MAJOR", null],
          "description": "NONE: delta >= -5%, MINOR: -5% > delta >= -10%, MAJOR: delta < -10%"
        }
      },
      "additionalProperties": false
    },
    "weakest_dimensions": {
      "type": "array",
      "items": {
        "type": "string",
        "enum": ["content", "linguistic", "reasoning", "emotional", "paradox"]
      },
      "description": "Dimensions scoring below 75%, ordered weakest first"
    },
    "remediation_required": {
      "type": "boolean",
      "description": "True if overall_result is FAIL or CONDITIONAL_PASS"
    },
    "remediation_plan": {
      "type": ["array", "null"],
      "items": {
        "type": "object",
        "required": ["dimension", "action", "priority"],
        "properties": {
          "dimension": {
            "type": "string",
            "enum": ["content", "linguistic", "reasoning", "emotional", "paradox"]
          },
          "action": {
            "type": "string",
            "description": "Specific remediation action"
          },
          "priority": {
            "type": "string",
            "enum": ["HIGH", "MEDIUM", "LOW"]
          },
          "deadline_days": {
            "type": "integer",
            "minimum": 1,
            "description": "Days until remediation must be completed"
          }
        },
        "additionalProperties": false
      },
      "description": "Required actions if remediation_required is true"
    },
    "test_details": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/test_detail"
      },
      "description": "Individual test results (optional, for detailed analysis)"
    },
    "source_materials_used": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["path", "type"],
        "properties": {
          "path": {
            "type": "string",
            "description": "Path to source material used for test generation"
          },
          "type": {
            "type": "string",
            "enum": ["transcription", "dna", "soul", "memory", "dossier", "external"],
            "description": "Type of source material"
          }
        },
        "additionalProperties": false
      },
      "description": "All source materials used to generate test cases"
    },
    "notes": {
      "type": "string",
      "description": "Free-form notes from the test administrator"
    }
  },
  "definitions": {
    "direct_quote_result": {
      "type": "object",
      "required": ["total_tests", "correctly_identified", "identification_rate", "status"],
      "properties": {
        "total_tests": {
          "type": "integer",
          "minimum": 1
        },
        "correctly_identified": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of times evaluator correctly identified the clone's quote"
        },
        "identification_rate": {
          "type": "number",
          "minimum": 0,
          "maximum": 100,
          "description": "Percentage of correct identifications. Lower is better (clone is indistinguishable)."
        },
        "by_difficulty": {
          "type": "object",
          "properties": {
            "easy": {
              "type": "object",
              "properties": {
                "total": { "type": "integer" },
                "correctly_identified": { "type": "integer" },
                "rate": { "type": "number" }
              },
              "additionalProperties": false
            },
            "medium": {
              "type": "object",
              "properties": {
                "total": { "type": "integer" },
                "correctly_identified": { "type": "integer" },
                "rate": { "type": "number" }
              },
              "additionalProperties": false
            },
            "hard": {
              "type": "object",
              "properties": {
                "total": { "type": "integer" },
                "correctly_identified": { "type": "integer" },
                "rate": { "type": "number" }
              },
              "additionalProperties": false
            }
          },
          "additionalProperties": false
        },
        "status": {
          "type": "string",
          "enum": ["PASS", "CONDITIONAL_PASS", "FAIL"],
          "description": "PASS: <40% identified, CONDITIONAL: 40-55%, FAIL: >55%"
        }
      },
      "additionalProperties": false
    },
    "decision_scenario_result": {
      "type": "object",
      "required": ["total_tests", "average_alignment", "status"],
      "properties": {
        "total_tests": {
          "type": "integer",
          "minimum": 1
        },
        "average_alignment": {
          "type": "number",
          "minimum": 0,
          "maximum": 100,
          "description": "Average alignment score across all decision scenario tests"
        },
        "alignment_distribution": {
          "type": "object",
          "properties": {
            "perfect": {
              "type": "integer",
              "description": "Tests scoring 100 (5/5 criteria)"
            },
            "strong": {
              "type": "integer",
              "description": "Tests scoring 80 (4/5 criteria)"
            },
            "moderate": {
              "type": "integer",
              "description": "Tests scoring 60 (3/5 criteria)"
            },
            "weak": {
              "type": "integer",
              "description": "Tests scoring 40 (2/5 criteria)"
            },
            "poor": {
              "type": "integer",
              "description": "Tests scoring 20 (1/5 criteria)"
            },
            "none": {
              "type": "integer",
              "description": "Tests scoring 0 (0/5 criteria)"
            }
          },
          "additionalProperties": false
        },
        "status": {
          "type": "string",
          "enum": ["PASS", "CONDITIONAL_PASS", "FAIL"],
          "description": "PASS: avg >= 75, CONDITIONAL: avg 60-74, FAIL: avg < 60"
        }
      },
      "additionalProperties": false
    },
    "style_result": {
      "type": "object",
      "required": ["total_tests", "composite_score", "status"],
      "properties": {
        "total_tests": {
          "type": "integer",
          "minimum": 1
        },
        "composite_score": {
          "type": "number",
          "minimum": 0,
          "maximum": 100
        },
        "by_dimension": {
          "type": "object",
          "properties": {
            "vocabulary": { "type": "number", "minimum": 0, "maximum": 100 },
            "rhetoric": { "type": "number", "minimum": 0, "maximum": 100 },
            "tone": { "type": "number", "minimum": 0, "maximum": 100 },
            "cadence": { "type": "number", "minimum": 0, "maximum": 100 },
            "analogy": { "type": "number", "minimum": 0, "maximum": 100 }
          },
          "additionalProperties": false
        },
        "status": {
          "type": "string",
          "enum": ["PASS", "CONDITIONAL_PASS", "FAIL"],
          "description": "PASS: composite >= 80, CONDITIONAL: 65-79, FAIL: < 65"
        }
      },
      "additionalProperties": false
    },
    "edge_case_result": {
      "type": "object",
      "required": ["total_tests", "tests_passed", "pass_rate", "status"],
      "properties": {
        "total_tests": {
          "type": "integer",
          "minimum": 1
        },
        "tests_passed": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of tests where >= 4/5 criteria were met"
        },
        "pass_rate": {
          "type": "number",
          "minimum": 0,
          "maximum": 100,
          "description": "Percentage of edge case tests that passed"
        },
        "by_subtype": {
          "type": "object",
          "properties": {
            "paradox": {
              "type": "object",
              "properties": {
                "total": { "type": "integer" },
                "passed": { "type": "integer" }
              },
              "additionalProperties": false
            },
            "nuance": {
              "type": "object",
              "properties": {
                "total": { "type": "integer" },
                "passed": { "type": "integer" }
              },
              "additionalProperties": false
            },
            "contradiction": {
              "type": "object",
              "properties": {
                "total": { "type": "integer" },
                "passed": { "type": "integer" }
              },
              "additionalProperties": false
            },
            "evolution": {
              "type": "object",
              "properties": {
                "total": { "type": "integer" },
                "passed": { "type": "integer" }
              },
              "additionalProperties": false
            },
            "boundary": {
              "type": "object",
              "properties": {
                "total": { "type": "integer" },
                "passed": { "type": "integer" }
              },
              "additionalProperties": false
            }
          },
          "additionalProperties": false
        },
        "status": {
          "type": "string",
          "enum": ["PASS", "CONDITIONAL_PASS", "FAIL"],
          "description": "PASS: >= 75% pass, CONDITIONAL: 60-74%, FAIL: < 60%"
        }
      },
      "additionalProperties": false
    },
    "dimension_score": {
      "type": "object",
      "required": ["score", "weight", "weighted_score"],
      "properties": {
        "score": {
          "type": "number",
          "minimum": 0,
          "maximum": 100,
          "description": "Raw score for this dimension (0-100)"
        },
        "weight": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Weight factor for composite calculation"
        },
        "weighted_score": {
          "type": "number",
          "minimum": 0,
          "maximum": 100,
          "description": "score * weight"
        },
        "below_threshold": {
          "type": "boolean",
          "description": "True if score < 75"
        },
        "primary_tests": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Test categories that primarily feed this dimension"
        },
        "notes": {
          "type": "string"
        }
      },
      "additionalProperties": false
    },
    "test_detail": {
      "type": "object",
      "required": ["test_id", "test_type", "result"],
      "properties": {
        "test_id": {
          "type": "string",
          "pattern": "^(DQ|DS|ST|EC)-\\d{3}$",
          "description": "Unique test identifier. DQ=Direct Quote, DS=Decision Scenario, ST=Style, EC=Edge Case"
        },
        "test_type": {
          "type": "string",
          "enum": ["direct_quote", "decision_scenario", "style", "edge_case"]
        },
        "difficulty": {
          "type": "string",
          "enum": ["easy", "medium", "hard"]
        },
        "source_reference": {
          "type": "string",
          "description": "Source file or chunk_id for the test case"
        },
        "result": {
          "type": "string",
          "enum": ["PASS", "FAIL"]
        },
        "score": {
          "type": "number",
          "minimum": 0,
          "maximum": 100
        },
        "evaluator_scores": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "evaluator_id": { "type": "string" },
              "score": { "type": "number" },
              "notes": { "type": "string" }
            },
            "additionalProperties": false
          }
        },
        "notes": {
          "type": "string"
        }
      },
      "additionalProperties": false
    }
  },
  "additionalProperties": false
}
